---
title: "Part 1: Working with time series data"
slug: "timeseries data"
subtitle: "Pharmacy Australia Centre of Excellence + Library R workshop"
author: "Stephane Guillou"
date: "2022-02-03"
categories: ["R"]
tags: [""]
output:
  blogdown::html_page:
    df_print: tibble
    toc: true
    number_sections: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, warnings = FALSE)
```

TEST 

**Catherine Kim, PhD**

Postdoctoral Associate, School of Biological Sciences  
Technology Trainer, The University of Queensland Library

- c dot kim @uq.edu.au
- [\@fishiinthec](https://twitter.com/fishiinthec)

# Today's schedule

* Session 1: Data manipulation with `dplyr`
* Session 2: Data visualization with `ggplot2`
* Session 3: Rmarkdown
* Session 4: Practice! #TidyTuesday or BYOData

## Prerequisites 

This R workshop assumes basic knowledge of R including:

* Installing and loading packages
* How to read in data
    + read.csv
    + read_csv
    + and similar
* Creating objects in R

We are happy to have any and all questions though!

## What are we going to learn?

In this hands-on session, you will use R, RStudio and the `dplyr` package to transform your data.

Specifically, you will learn how to **explore, filter, reorganise and process** a table of data with the following verbs:

* `select()`: pick variables
* `filter()`: pick observations
* `arrange()`: reorder observations
* `mutate()`: create new variables
* `summarise()`: collapse to a single summary
* `group_by()`: change the scope of function
* `joins`: combine dataframes based on a common variable
* `pivots`: transform dataframes into long and wide formats

## Load packages

```{r packages, warning=FALSE}
library(tidyverse)
library(lubridate)
```

## Read in the data

### Lizard size measurement data

Our data sets are a curated subset from [Jornada Basin Long Term Ecological Research site](https://lter.jornada.nmsu.edu/) in New Mexico, part of the US Long Term Ecological Research (LTER) network: 

- Lightfoot, D. and W.G. Whitford. 2020. Lizard pitfall trap data from 11 NPP study locations at the Jornada Basin LTER site, 1989-2006 ver 37. Environmental Data Initiative. https://doi.org/10.6073/pasta/4a6e258fb49c31e222ecbbcfd128967f

From the data package: "This data package contains data on lizards sampled by pitfall traps located at 11 consumer plots at Jornada Basin LTER site from 1989-2006. The objective of this study is to observe how shifts in vegetation resulting from desertification processes in the Chihuahaun desert have changed the spatial and temporal availability of resources for consumers. Desertification changes in the Jornada Basin include changes from grass to shrub dominated communities and major soil changes. If grassland systems respond to rainfall without significant lags, but shrub systems do not, then consumer species should reflect these differences. In addition, shifts from grassland to shrubland results in greater structural heterogeneity of the habitats. We hypothesized that consumer populations, diversity, and densities of some consumers will be higher in grasslands than in shrublands and will be related to the NPP of the sites. Lizards were captured in pitfall traps at the 11 LTER II/III consumer plots (a subset of NPP plots) quarterly for 2 weeks per quarter. Variables measured include species, sex, recapture status, snout-vent length, total length, weight, and whether tail is broken or whole. This study is complete." 

There are 16 total variables in the lizards.csv data we'll read in. The ones we'll use in this workshop are:

* `date`: data collection date
* `scientific_name`: lizard scientific name
* `common_name`: lizard common name
* `site`: research site code
* `sex`: lizard sex (m = male; f = female; j = juvenile)
* `sv_length`: snout-vent length (millimeters)
* `total_length`: body length (millimeters)
* `toe_num`: toe mark number
* `weight`: body weight (grams)
* `tail`: tail condition (b = broken; w = whole)

```{r read lizards, message=FALSE}
# to read the code in from github use the following:
# code <- read_csv("https://raw.githubusercontent.com/seaCatKim/CBCS-LIB_Rworkshop/main/content/post/2020-12-01-r-rmarkdown/data/jornada_lizards.csv")

lizards <- read_csv("data/jornada_lizards.csv", trim_ws = TRUE) %>% 
  mutate(date = as.Date(date, format = '%m/%d/%y')) %>% 
  mutate_if(is.character, as.factor)
glimpse(lizards)

class(lizards)
```

### Annual mean estimates net primary production (NPP)

- Peters, D. and L. Huenneke. 2020. Annual mean estimates of aboveground net primary production (NPP) at 15 sites at Jornada Basin LTER, 1989-ongoing ver 104. Environmental Data Initiative. https://doi.org/10.6073/pasta/18dad6748af96c98b72cea3436bf7fe4 (Accessed 2021-11-02).

From the data package: "This package contains values of mean annual aboveground net primary production (NPP, in grams per square meter per year) at 15 NPP study sites on Jornada Experimental Range (JER) and Chihuahuan Desert Rangeland Research Center (CDRRC) lands. Sites were selected to represent the 5 major ecosystem types in the Chihuahuan Desert (upland grasslands, playa grasslands, mesquite-dominated shrublands, creosotebush-dominated shrublands, tarbush-dominated shrublands)."

```{r read NPP, message=FALSE}
npp <- read_csv("data/jornada_npp.csv") %>% 
  mutate_if(is.character, as.factor)
glimpse(npp)
```

